<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- <link rel="icon" href="%PUBLIC_URL%/favicon.ico" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <!-- <meta
      name="description"
      content="Web site created using create-react-app"
    /> -->
    <!-- <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" /> -->
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <!-- <link rel="manifest" href="%PUBLIC_URL%/manifest.json" /> -->
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title id="websiteTitle">Thomas Rosen</title>

	<script src="%PUBLIC_URL%/old/moment.min.js"></script>

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			-webkit-overflow-scrolling: touch;
		}

		body{
			overflow: hidden !important;
		}


		a{
			color: hsl(150,70%,40%);
			text-decoration: normal !important;
			text-decoration-style: dotted !important;
			text-decoration-color: hsl(150,70%,40%);
		}


		/*.sortingTitle{
			font-family: Futura;
			font-size: 2rem;
			line-height: 2.2rem;

			margin: 0 30px 30px 30px;
			color: white;
			opacity: 0.6;
		}*/

		.pageTitle,
		.infos .name{
			font-family: "Ubuntu Mono", Ubuntu, sans-serif;
			font-weight: lighter;
			font-size: 109px;
			letter-spacing: -1.5px;

			margin: 60px 30px;
			color: black;
		}
		.infos{
			margin: 10px -10px;
			color: black;
			background: rgba(255,255,255,0.8);
			padding: 30px 40px;
			/*border-bottom: 10px solid black;*/
		}
		.infos .name{
			font-size: 2rem;
			line-height: 2.2rem;
			color: black;
			margin: 0;
		}
		.infos .name + p{
			margin-top: 30px;
		}
		.infos p + .more{
			margin-top: 30px;
		}


		.bottomSpace{
			margin: 180px 10px;
			padding: 30px;
			background: white;
		}
		.bottomSpace h2{
			font-family: "Ubuntu Mono", Ubuntu, sans-serif;
			font-weight: lighter;
			font-size: 68px;
			letter-spacing: -0.5px;

			color: black;
			margin: 30px 0 10px;
		}
		.bottomSpace h2:first-of-type{
			margin: 0 0 10px;
		}
		.bottomSpace p,
		.bottomSpace li{
			color: black;
			margin: 10px 0 0 0;
		}




		/* stage_box */
		.stage_box {
			border-width: 5px 5px 5px 10px;
			padding: 30px;
			background: transparent;
			color: black;

			min-height: 450px;
			max-width: calc(100vw - 64px);

			display: flex;
			flex-direction: column;
			justify-content: flex-end;

			cursor: pointer;
			/*transition: transform 0.2s ease, opacity 0.2s ease, filter 0.2s ease;*/
			/*transition: transform 0.2s ease, box-shadow 0.2s ease;*/
			/*transition: transform 0.2s ease;*/

			background: hsl(150,60%,60%);
			border: 8px solid hsl(150,60%,60%);

			transform-style: preserve-3d;
			transform: perspective(2000px);
		}
		.stage_box.depth_1,
		.stage_box.depth_2,
		.stage_box.depth_3 {
			padding: 10px;
			margin: 10px 0;
			border-width: 1px 1px 1px 10px;
		}
		.stage_box:first-of-type{
			margin-top: 0;
		}
		.stage_box:last-of-type{
			margin-bottom: 0;
		}
		.stage_box .shortname{
			font-family: "Ubuntu Mono", Ubuntu, sans-serif;
			font-weight: normal;
			font-size: 55px;
			letter-spacing: 0px;

			overflow-wrap: break-word;
			hyphens: auto;
			margin-top: 60px;

			transform: translateZ(40px);
		}
		.stage_box .main_content{
			background: white;
			margin: -30px -30px -30px -30px !important;
			padding: 30px;
			flex-grow: 2;

			display: flex;
			flex-direction: column;
			justify-content: flex-end;

			transform-style: preserve-3d;
			transform: perspective(2000px);
		}
		.stage_box .teaser{
			/*border-top: 1px dotted black;*/

			background: rgba(255,255,255,0.8);
			color: black;
			margin: 30px -30px -30px -30px !important;
			padding: 30px;
			display: inline-block;
			position: relative;
		}

		.stage_box .shortname + p{
			margin-top: 25px;
		}
		.stage_box p + .name{
			margin-top: 10px;
		}

		@media (max-width: 629px) {
			.stage_box {
				min-height: auto;
			}
			.stage_box .shortname{
				margin-top: 0;
			}
		}



		#pages{
			position: relative;
			height: 100vh;
			width: 100vw;
		}

		/* page */
		.page{
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;

			/*background: linear-gradient(to bottom, #2CA4F4, #C2E6FB);*/
			/*background: rgb(45,97,153);*/
			/*background: linear-gradient(135deg, rgba(45,97,153,1) 0%,rgba(255,127,127,1) 100%);*/
			/*background: linear-gradient(to bottom, rgba(255,255,255,1) 0%,rgba(0,255,0,1) 100%);*/
			/*background: linear-gradient(to bottom, rgba(181,238,255,1) 0%,rgba(84,255,155,1) 100%);*/
			/*background: linear-gradient(to bottom, rgba(153,207,216,1) 0%,rgba(84,255,155,1) 100%);*/
			/*background: hsl(150,60%,60%);*/
			/*background: linear-gradient(to bottom, hsl(190,30%,50%) 0%,hsl(150,80%,70%) 100%);*/
			/* http://www.colorzilla.com/gradient-editor/ */
			background: white;

			display: block;
			overflow-x: hidden;
			overflow-y: auto;

			padding: 16px;

			opacity: 0;
			animation: fadeIn 0.2s ease forwards;
		}
		.page.fadeOut{
			opacity: 1;
			animation: fadeOut 0.2s ease forwards;
		}
		@keyframes fadeIn {
			from {
				opacity: 0;
			}
			to {
				opacity: 1;
			}
		}
		@keyframes fadeOut {
			from {
				opacity: 1;
			}
			to {
				opacity: 0;
			}
		}
		.page{
			pointer-events: none;
		}
		.page:last-of-type{
			pointer-events: all;
		}

		.display_as_grid {
			position: relative;
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
			justify-items: stretch;
			align-items: stretch;
			/*justify-content: center;*/
			grid-gap: 32px 32px;

			margin: 16px 16px 32px 16px;
		}





		.header_links{
			/*display: block;*/
			list-style: none;

			margin: -20px -10px 0 -10px;
			color: black;
			padding: 30px 40px 30px 40px;

			font-family: "Ubuntu Mono", Ubuntu, sans-serif;
			font-weight: normal;
			font-size: 18px;
			letter-spacing: 0.15px;

			/*background: white;*/
		}
		.header_links li{
			margin-bottom: 4px;
		}
		.header_links li a{
			color: inherit;
			text-decoration: none;
		}
		.header_links li a:hover{
			text-decoration: underline;
		}
		.header_links li .icon:before{
			display: inline-block;
			content: attr(data-icon);
			width: 128px;
			text-align: right;
		}
		.header_links li .icon:not([data-icon=""]):after{
			display: inline-block;
			content: ":";
			text-align: right;
		}
		.header_links li .icon.bold:before,
		.header_links li .icon.bold:not([data-icon=""]):after{
            font-weight: bold;
        }
		.header_links li a[href=""]{
			cursor: default;
		}

	</style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root" style="display: none;"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->




	<div id="pages"></div>

	<div id="DataProtection" class="bottomSpace" style="display:none;">
		<h2>Datenschutzerklärung</h2>
		<p>Verantwortliche Stelle im Sinne der Datenschutzgesetze, insbesondere der EU-Datenschutzgrundverordnung (DSGVO), ist:</p>
		<p>Thomas Rosen</p>
		<h2>Ihre Betroffenenrechte</h2>
		<p>Unter den angegebenen Kontaktdaten unseres Datenschutzbeauftragten können Sie jederzeit folgende Rechte ausüben:</p>
		<ul>
		<li>Auskunft über Ihre bei uns gespeicherten Daten und deren Verarbeitung (Art. 15 DSGVO),</li>
		<li>Berichtigung unrichtiger personenbezogener Daten (Art. 16 DSGVO),</li>
		<li>Löschung Ihrer bei uns gespeicherten Daten (Art. 17 DSGVO),</li>
		<li>Einschränkung der Datenverarbeitung, sofern wir Ihre Daten aufgrund gesetzlicher Pflichten noch nicht löschen dürfen (Art. 18 DSGVO),</li>
		<li>Widerspruch gegen die Verarbeitung Ihrer Daten bei uns (Art. 21 DSGVO) und</li>
		<li>Datenübertragbarkeit, sofern Sie in die Datenverarbeitung eingewilligt haben oder einen Vertrag mit uns abgeschlossen haben (Art. 20 DSGVO).</li>
		</ul>
		<p>Sofern Sie uns eine Einwilligung erteilt haben, können Sie diese jederzeit mit Wirkung für die Zukunft widerrufen.</p>
		<p>Sie können sich jederzeit mit einer Beschwerde an eine Aufsichtsbehörde wenden, z. B. an die zuständige Aufsichtsbehörde des Bundeslands Ihres Wohnsitzes oder an die für uns als verantwortliche Stelle zuständige Behörde.</p>
		<p>Eine Liste der Aufsichtsbehörden (für den nichtöffentlichen Bereich) mit Anschrift finden Sie unter: <a href="https://www.bfdi.bund.de/DE/Infothek/Anschriften_Links/anschriften_links-node.html" target="_blank" rel="nofollow noopener">https://www.bfdi.bund.de/DE/Infothek/Anschriften_Links/anschriften_links-node.html</a>.</p>
		<p></p><h2>SSL-Verschlüsselung</h2>
		<p>Um die Sicherheit Ihrer Daten bei der Übertragung zu schützen, verwenden wir dem aktuellen Stand der Technik entsprechende Verschlüsselungsverfahren (z. B. SSL) über HTTPS.</p>
		<p></p><h2>Änderung unserer Datenschutzbestimmungen</h2>
		<p>Wir behalten uns vor, diese Datenschutzerklärung anzupassen, damit sie stets den aktuellen rechtlichen Anforderungen entspricht oder um Änderungen unserer Leistungen in der Datenschutzerklärung umzusetzen, z.B. bei der Einführung neuer Services. Für Ihren erneuten Besuch gilt dann die neue Datenschutzerklärung.</p>
		<h2>Fragen an den Datenschutzbeauftragten</h2>
		<p>Wenn Sie Fragen zum Datenschutz haben, schreiben Sie uns bitte eine E-Mail oder wenden Sie sich direkt an die für den Datenschutz verantwortliche Person in unserer Organisation:</p>
		<p>business.thomas.rosen@gmail.com</p>
		<p><em>Die Datenschutzerklärung wurde mit dem </em><em><a href="https://www.activemind.de/datenschutz/datenschutzhinweis-generator/" target="_blank" rel="noopener">Datenschutzerklärungs-Generator der activeMind AG erstellt</a> (Version 2018-06-22).</em></p>
	</div>

	<script>
		var __websiteTitle = document.querySelector('#websiteTitle')
		var __pages = document.querySelector('#pages')
		var __DataProtection = document.querySelector('#DataProtection')
		var __sort_over = 'newest_date' // newest_date / oldest_date
		var __all_data = {}

		function loadJSON(fileurl, callback) {   
			var xobj = new XMLHttpRequest()
			xobj.overrideMimeType("application/json")
			xobj.open('GET', fileurl, true)
			xobj.addEventListener('readystatechange', ()=>{
				if (xobj.readyState == 4 && xobj.status == "200") {
					// Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
					callback(xobj.responseText)
				}
			})
			xobj.send(null)
		}

		function datestring2timestamp(datestring){
			if (!!datestring) {
				let parts_match = /((.*)\/)?(.*)/gm.exec(datestring)

				let precision = ''
				let precision_match = /(?:(\d{4})(?:\.(\d{2})(?:\.(\d{2}))?)?)?(?:[^\S\n](\d{2})(?:\:(\d{2})(?:\:(\d{2})(?:\.(\d+))?)?)?)?/g.exec(parts_match[3])
				if (!!precision_match[7]) {
					precision = 'S'
				} else if (!!precision_match[6]) {
					precision = 's'
				} else if (!!precision_match[5]) {
					precision = 'm'
				} else if (!!precision_match[4]) {
					precision = 'H'
				} else if (!!precision_match[3]) {
					precision = 'D'
				} else if (!!precision_match[2]) {
					precision = 'M'
				} else if (!!precision_match[1]) {
					precision = 'Y'
				}

				return {
					is_date: true,
					precision: precision,
					prefix: parts_match[2],
					x: moment(parts_match[3], 'YYYY.MM.DD HH:mm:ss.SSSSS').format('x')*1
				}
			}

			return {
				is_date: false,
				precision: null,
				prefix: null,
				x: null
			}
		}

		function getShortestDate(dateInfo){
			let datestring = ''

			if (!!dateInfo) {
				let timestamp = dateInfo.x
				let precision = dateInfo.precision
				let prefix = dateInfo.prefix
	
				let this_moment = moment(timestamp)
				if (precision == 'S') {
					datestring = this_moment.format('DD. MMM. YYYY HH:mm:ss.SSSSS')
				}else if (precision == 's') {
					datestring = this_moment.format('DD. MMM. YYYY HH:mm:ss')
				}else if (precision == 'm') {
					datestring = this_moment.format('DD. MMM. YYYY HH:mm')
				}else if (precision == 'H') {
					datestring = this_moment.format('DD. MMM. YYYY HHa')
				}else if (precision == 'D') {
					datestring = this_moment.format('DD. MMM. YYYY')
				}else if (precision == 'M') {
					datestring = this_moment.format('MMM YYYY')
				}else /*if (precision == 'Y')*/ {
					if (!!prefix && prefix != '') {
						datestring = prefix+' '+this_moment.format('YYYY')
					}else{
						datestring = this_moment.format('YYYY')
					}
				}
			}

			return datestring
		}

		function generateSlug(stage){
			if (!!stage.slug) {
				return stage.slug
			}

			let slug = (!!stage.name ? stage.name : '')
			slug = slug.replace(/[^A-Z0-9]/gi, '_')
			return slug
		}

		function betterStages(stage){
			stage.s_date_info = datestring2timestamp(stage.s_date)
			stage.e_date_info = datestring2timestamp(stage.e_date)
			stage.date_info = datestring2timestamp(stage.date)
					
			stage.slug = generateSlug(stage)
			if (!!stage.stages) {
				let better_stages = []
				for (let subStage of stage.stages) {
					subStage.parent = stage
					subStage = betterStages(subStage)					
					better_stages.push(subStage)
				}
				stage.stages = better_stages
			}

			return stage
		}

		function sortStages(stages){
			let sorted_stages = []

			for (let stage of stages) {
				if (!!stage.name) {

					let newestDateInfo = null
					if (__sort_over == 'newest_date') {
						newestDateInfo = getExtremeDateInfo(1, stage)
					} else if (__sort_over == 'oldest_date') {
						newestDateInfo = getExtremeDateInfo(-1, stage)
					}

					if (newestDateInfo == null) {
						let most_past_date = (!!stage.s_date ? stage.s_date : (!!stage.date ? stage.date : stage.e_date))
						newestDateInfo = datestring2timestamp(most_past_date)
					}
					stage.sort_date_info = newestDateInfo
					stage.sort_date = newestDateInfo.date.x

					if (!!stage.stages) {
						stage.stages = sortStages(stage.stages)
					}

					sorted_stages.push(stage)
				}
			}

			sorted_stages.sort((a,b)=>{
				return b.sort_date - a.sort_date
			})

			return sorted_stages
		}

		function getYoungestDate(direction, stage){
			let newestDateX = (direction == 1 ? 0 : 999999999999999999999999999999)
			if (direction == 1) {
				if (stage.date_info.is_date && stage.date_info.x > newestDateX) {
					return stage.date_info
				}
				if (stage.s_date_info.is_date && stage.s_date_info.x > newestDateX) {
					return stage.s_date_info
				}
				// if (stage.e_date_info.is_date && stage.e_date_info.x > newestDateX) {
					return stage.e_date_info
				// }
			}else{
				if (stage.date_info.is_date && stage.date_info.x < newestDateX) {
					return stage.date_info
				}
				if (stage.e_date_info.is_date && stage.e_date_info.x < newestDateX) {
					return stage.e_date_info
				}
				// if (stage.s_date_info.is_date && stage.s_date_info.x < newestDateX) {
					return stage.s_date_info
				// }
			}
			return null
		}

		function getExtremeDateInfo(direction, stage, parentCount){
			if (!(!!parentCount)) {
				parentCount = 0
			}

			let date = getYoungestDate(direction, stage)
			let deepestParentCount = parentCount

			if (!!stage.stages) {
				for (let subStage of stage.stages) {
					let results = getExtremeDateInfo(direction, subStage, parentCount+1)
					let check = false
					if (direction == 1) {
						check = results.date.x >= date.x
					}else{
						check = results.date.x <= date.x
					}
					if (check) {
						date = results.date
						deepestParentCount = results.deepestParentCount
						if (parentCount == 0) {
							stage = results.stage
						}
					}
				}
			}

			return {
				date: date,
				stage: stage,
				deepestParentCount: deepestParentCount
			}
		}

		function getShortName(stage){
			if (!!stage) {
				if (!!stage.shortname) {
					return stage.shortname
				}
				return stage.name
			}
			return 'PROBLEM'
		}
		function getDateRangeText(stage){
			if (!!stage.s_date && !!stage.e_date) {
				return 'von '+getShortestDate(stage.s_date_info)+' bis '+getShortestDate(stage.e_date_info)
			} else if (!!stage.s_date) {
				return 'ab '+getShortestDate(stage.s_date_info)
			}else if (!!stage.e_date) {
				return 'bis '+getShortestDate(stage.e_date_info)
			}else if (!!stage.date && !(stage.date*1 < 0)) {
				return getShortestDate(stage.date_info)
			}
			return ''
		}

		function getStageBox(stage, depth){
			if (!!stage.name) {
				let box = document.createElement('div')
				box.classList.add('stage_box')
				box.classList.add('depth_'+depth)

				box.setAttribute('data-tilt', true)
				box.setAttribute('data-tilt-perspective', 2000)
				box.setAttribute('data-tilt-reverse', true)
				// box.setAttribute('data-tilt-glare', true)
				// box.setAttribute('data-tilt-max-glare', 0.8)
				box.setAttribute('data-tilt-scale', 0.98)
				// box.setAttribute('data-tilt-transition', 1000)
				// box.setAttribute('data-tilt-max', 15)
				// box.setAttribute('data-tilt-full-page-listening', true)
				box.setAttribute('data-tilt-gyroscope', false)
				VanillaTilt.init(box)


				let main_content = document.createElement('div')
				main_content.classList.add('main_content')

				// shortname
				let box_shortname = getShortName(stage)
				let shortname = document.createElement('h1')
				shortname.classList.add('shortname')
				shortname.innerHTML = box_shortname
				main_content.appendChild(shortname)

				// date range
				let dateRangeText = getDateRangeText(stage)
				if (dateRangeText != '') {
					let dateRange = document.createElement('p')
					dateRange.classList.add('when')
					dateRange.innerHTML = '<strong>'+dateRangeText+'</strong>'
					main_content.appendChild(dateRange)
				}

				// place
				if (!!stage.place) {
					let place = document.createElement('p')
					place.classList.add('where')
					place.innerHTML = stage.place
					main_content.appendChild(place)
				}
				
				if (!!stage.shortname && stage.shortname != stage.name) {
					let name = document.createElement('p')
					name.classList.add('name')
					name.innerHTML = stage.name
					main_content.appendChild(name)
				}

				box.appendChild(main_content)


				if (__sort_over == 'newest_date' || __sort_over == 'oldest_date') {
					if (!!stage.sort_date_info.stage) {
					let teaser_shortname = getShortName(stage.sort_date_info.stage)

					if (teaser_shortname != box_shortname){
							let teaser = document.createElement('div')
							teaser.classList.add('teaser')
							if (__sort_over == 'newest_date') {
								teaser.innerHTML += '<p>'+getShortestDate(stage.sort_date_info.date)+'</p>'
							} else if (__sort_over == 'oldest_date') {
								teaser.innerHTML += '<p>'+getShortestDate(stage.sort_date_info.date)+'</p>'
							}
							// ▶🗄📂📁🗃
							teaser.innerHTML += '<p>'+(stage.sort_date_info.deepestParentCount > 1 ? '📂 ' : '')+getShortName(stage.sort_date_info.stage)+'</p>'
							box.appendChild(teaser)

							// box.classList.add('has_teaser')
						}
					}
				}



				// // name and more
				// if (!!stage.shortname || !!stage.more) {
				// 	let more = document.createElement('p')
				// 	more.classList.add('more')
				// 	more.innerHTML = (!!stage.shortname ? '<strong>'+stage.name+'</strong>' : '')+(!!stage.shortname && !!stage.more ? '<br>' : '')+(!!stage.more ? stage.more : '')
				// 	box.appendChild(more)



				// // stages
				// if (!!stage.stages) {
				// 	let stages = document.createElement('div')
				// 	stages.classList.add('stages')
				// 	box.appendChild(stages)
				// 	addStageBoxes(stages, sortStages(stage.stages, 0), depth+1)
				// }

				return box
			}

			return null
		}

		function joinSlugs(slugs){
			return '#/'+slugs.join('/')
		}

		function addStageBoxes(stageElement, stages, depth, slugs){
			if (!!stages) {
				if (!(!!depth)) { 
					depth = 0
				}

				for (let stage of stages) {
					let stageBox = getStageBox(stage, depth)
					stageBox.addEventListener('click', ()=>{
						window.history.pushState({} , '', joinSlugs(slugs.concat([stage.slug])))
						// window.detatchEvent(new Event('popstate'))
						// window.history.back()
						// window.history.forward()
						gotoHashLocation()
					})
					if (!!stageBox) {
						stageElement.appendChild(stageBox)
					}
				}
			}
		}

		function addPage(pages, stage, depth, slugs){
			let page = document.createElement('div')
			page.classList.add('page')

			page.setAttribute('slug', stage.slug)
			page.setAttribute('slugs', joinSlugs(slugs))
			

			let pageTitle = document.createElement('h1')
			pageTitle.classList.add('pageTitle')
			pageTitle.innerHTML = getShortName(__all_data)
			page.appendChild(pageTitle)



			let title = ''
			let dateRangeText = getDateRangeText(stage)
			if ((depth > 0 && stage.name) || (!!stage.place && stage.place != '') || dateRangeText != '' || !!stage.more) {
				title = getShortName(stage)
				// let closeButton = document.createElement('h1')
				// closeButton.classList.add('pageTitle')
				// closeButton.style.cursor = 'pointer'
				// closeButton.innerHTML = '◀ Back'
				// closeButton.addEventListener('click', ()=>{
				// 	window.history.back()
				// })
				// page.appendChild(closeButton)

				
				let infos = document.createElement('div')
				infos.classList.add('infos')

				if (depth > 0) {
					let stageTitle = document.createElement('h2')
					stageTitle.classList.add('name')
					stageTitle.innerHTML = stage.name
					infos.appendChild(stageTitle)
				}

				
				let dateRangeText = getDateRangeText(stage)
				if (dateRangeText != '') {
					let when = document.createElement('p')
					when.classList.add('when')
					when.innerHTML = "<strong>"+dateRangeText+"</strong>"
					infos.appendChild(when)
				}

				if (!!stage.place && stage.place != '') {
					let where = document.createElement('p')
					where.classList.add('where')
					where.innerHTML = stage.place
					infos.appendChild(where)
				}

				if (!!stage.more) {
					let more = document.createElement('p')
					more.classList.add('more')
					more.innerHTML = stage.more
					infos.appendChild(more)
				}

				page.appendChild(infos)
			}
			
			
			

			if (!!stage.header_links && stage.header_links.length > 0) {
				const header_links_mapped = stage.header_links.map(([icon, text, link, color]) => `
					<li>
						${link.length > 0 ? `<a href="${link}" target="_blank" rel="nofollow">` : ''}
							<span class="icon ${text === '' ? 'bold' : ''}" data-icon="${icon}" style="color: ${color};"></span>
							<span class="text">${text}</span>
						${link.length > 0 ? `</a>` : ''}
					</li>
				`)

				let header_links_element = document.createElement('ul')
				header_links_element.classList.add('header_links')
				header_links_element.innerHTML = header_links_mapped.join('')
				page.appendChild(header_links_element)
			}



			// let sortingTitle = document.createElement('h1')
			// sortingTitle.classList.add('sortingTitle')
			// if (__sort_over == 'newest_date') {
			// 	sortingTitle.innerHTML = 'Newest first'
			// } else if (__sort_over == 'oldest_date') {
			// 	sortingTitle.innerHTML = 'Oldest first'
			// }
			// // sortingTitle.innerHTML = '<strong>Newest first</strong> Oldest first | <strong>DE</strong> EN'
			// page.appendChild(sortingTitle)


			if (!!stage.stages) {
				let wrapper = document.createElement('div')
				wrapper.classList.add('display_as_grid')
				addStageBoxes(wrapper, stage.stages, 0, slugs)
				page.appendChild(wrapper)
			}


			// // add the DataProtection to the bottom
			// let dpClone = __DataProtection.cloneNode(true)
			// dpClone.style.display = 'block'
			// page.appendChild(dpClone)



			page.setAttribute('title', (!!title && title != '' ? [__all_data.name, title].join(' — ') : __all_data.name))

			pages.appendChild(page)
		}

		function trasverseBackwards(stage){
			let stages = []

			if (!!stage.parent) {
				stages.push(stage.parent)
				stages = stages.concat(trasverseBackwards(stage.parent))
			}

			return stages
		}

		function findStageBySlugs(stage, slugs){
			let wantedSlug = slugs[slugs.length-1]

			if (wantedSlug == stage.slug) {
				return stage
			} else if (!!stage.stages && slugs.length > 0) {
				for (let subStage of stage.stages) {
					let foundStage = findStageBySlugs(subStage, slugs)
					if (foundStage != null) {
						return foundStage
					}
				}
			}

			return null
		}

		function gotoHashLocation(){
			let url_hash = window.location.hash
			let slugs = url_hash.split('/')
			slugs = slugs.slice(1)



			let foundStage = findStageBySlugs(__all_data, slugs)
			if (foundStage == null) {
				foundStage = __all_data
			}

			let stagesPath = trasverseBackwards(foundStage)
			stagesPath.reverse().push(foundStage)

			let exceptedSlugs = []
			for (let sp_stage of stagesPath) {
				exceptedSlugs.push(sp_stage.slug)
			}






			let pages = __pages.querySelectorAll('.page')
			
			for (let page of pages) {
				let pos = exceptedSlugs.indexOf(page.getAttribute('slug'))
				if (pos > -1) {
					exceptedSlugs.splice(pos, 1)
				}else{
					if (page.parentNode) {
						page.classList.add('fadeOut')
						setTimeout(()=>{
							page.parentNode.removeChild(page)
						}, 200)
					}
				}
			}



			let sp_slugs = []
			for (let sp_stage of stagesPath) {
				sp_slugs.push(sp_stage.slug)
				if (exceptedSlugs.indexOf(sp_stage.slug) > -1) {
					addPage(__pages, sp_stage, sp_slugs.length-1, sp_slugs)
				}
			}


			// set website title
			setTimeout(()=>{
				pages = __pages.querySelectorAll('.page')
				let topMostPage = pages[pages.length-1]
				__websiteTitle.innerHTML = topMostPage.getAttribute('title')
			}, 300)
		}
		window.addEventListener('popstate', event=>{
			gotoHashLocation()
		})

		loadJSON('%PUBLIC_URL%/old/data.json', jsonText=>{
			let data = JSON.parse(jsonText)
			data = betterStages(data)
			data.stages = sortStages(data.stages)
			__all_data = data

			gotoHashLocation()
			// addPage(__pages, __all_data, 0, [])
		})
	</script>
  </body>
</html>
